
<!--#### A application main navigation component-->
<dom-module id="c-main-navigation">
  <!--TODO maya5j-->
  <!--See https://github.com/GoogleWebComponents/google-map/blob/master/google-map-marker.html-->
  <!--Polymer library is included in the component. Other libraries are on the client side see-->
  <!--https://github.com/GoogleWebComponents/google-map/blob/master/index.html-->
  <!--Include it here??-->
  <!--link(rel="import" href="https://static.scania.com/vendors/frameworks/bootstrap/3.2.0/dist/js/bootstrap.min.js")-->
  <link rel="import" href="variation-1.html"/>
  <link rel="import" href="../../Bootstrap/navbar/nav-item/nav-item.html"/>
  <link rel="import" href="sub-navigation/sub-navigation.html"/>
  <link rel="import" href="../fullscreen/fullscreen.html"/>
  <template>
    <style>:host .navbar-collapse {
  padding: 0;
  font-family: 'Scania Sans Bold';
}
:host-context(.app) ::content nav-item a {
  padding-top: 16px;
  padding-bottom: 16px;
}
@media (max-width: 991px) {
  :host .navbar-collapse {
    background-color: #f5f5f5;
    border-top: 0px;
    padding: 0;
    font-size: 1.2rem;
  }
  :host-context(.app) ::content nav-item a {
    padding: 10px 25px;
    margin-left: 0;
    border-bottom: 1px solid #e2e2e2;
  }
}
:host {
  display: none;
  transition: height 100ms ease;
}
:host .navbar-footer {
  display: none;
}
:host ::content primary-items {
  display: inline-block;
}
:host ::content secondary-items {
  display: inline-block;
}
:host ::content > .navbar {
  height: inherit;
  box-shadow: 0 0 0 0 transparent;
  transition: box-shadow 0.15s ease-in-out;
}
:host ::content .navbar-nav.navbar-right:last-child {
  margin-right: 1px;
  -webkit-transition: margin-right 100ms ease;
  -moz-transition: margin-right 100ms ease;
  -o-transition: margin-right 100ms ease;
  -ms-transition: margin-right 100ms ease;
  transition: margin-right 100ms ease;
}
:host ::content .more {
  display: inline-block !important;
}
:host ::content .more li {
  display: none;
}
:host ::content .dropdown-menu {
  max-height: 70vh;
  overflow-y: scroll;
}
:host-context(.app) ::content nav-item:first-child a:before {
  padding-left: 0;
}
:host-context(.header-is-sticky) ::content > .navbar {
  position: fixed;
  top: -1px;
  left: 0;
  right: 0;
  -webkit-box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.15);
  box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.15);
}
:host-context(.header-is-sticky) ::content .navbar-nav.navbar-right {
  margin-right: 80px;
}
:host-context(body.fullscreen) ::content .navbar-nav.navbar-right {
  margin-right: 1px;
}
:host-context(.app.header-is-sticky) ::content .navbar-nav.navbar-right {
  margin-right: 60px;
}
@media (max-width: 991px) {
  :host .navbar-footer {
    height: 55px;
  }
  :host .navbar-footer ::content nav-item {
    padding-left: 0;
    padding-right: 0;
    margin: 0;
  }
  :host .navbar-footer ::content nav-item a {
    padding-top: 15px;
    padding-bottom: 15px;
  }
  :host .navbar-toggle {
    display: inline-block;
    float: left;
    border: 1px solid #e2e2e2;
    padding: 0;
    margin: 0 0 -1px;
    border-radius: 0;
  }
  :host .navbar-toggle:hover {
    background-color: transparent;
  }
  :host .navbar-toggle ::content a {
    padding: 19px;
    font-size: 1.4em;
  }
  :host .navbar-toggle ::content a:hover,
  :host .navbar-toggle ::content a:focus {
    color: inherit;
    outline: none;
  }
  :host .navbar-toggle ::content a.collapsed .icon-expander:before {
    content: "\e6b1";
  }
  :host .navbar-toggle ::content a > span {
    padding: 0;
    border-left: 0;
  }
  :host .navbar-toggle ::content a .icon-expander {
    display: inline-block;
    width: 18px;
  }
  :host .navbar-toggle ::content a .icon-expander:before {
    content: "\e60d";
  }
  :host nav .navbar-collapse.collapsing {
    overflow-y: hidden !important;
  }
  :host nav .navbar-collapse.collapsing + .navbar-footer {
    display: block;
  }
  :host nav .navbar-collapse.collapse {
    display: none !important;
  }
  :host nav .navbar-collapse.collapse.in {
    display: block !important;
  }
  :host nav .navbar-collapse.collapse.in + .navbar-footer {
    display: block;
  }
  :host nav .navbar-collapse.in {
    height: 100% !important;
    overflow-y: scroll !important;
  }
  :host > .navbar-default {
    display: none;
    min-height: 0;
  }
  :host ::content nav-item a {
    padding-top: 25px;
    padding-bottom: 25px;
  }
  :host ::content nav-item a:focus {
    color: inherit;
  }
  :host ::content nav-item a > span {
    border-left: 0;
    padding-left: 2rem;
    padding-right: 2rem;
  }
  :host ::content nav-item a > span[class^="icon-"] {
    line-height: inherit;
  }
  :host ::content primary-items {
    display: block;
  }
  :host ::content primary-items > nav-item {
    background-color: #f5f5f5;
    display: block;
    position: relative;
  }
  :host ::content primary-items > nav-item > a:hover span {
    text-decoration: none;
  }
  :host ::content secondary-items {
    display: block;
  }
  :host ::content secondary-items > nav-item {
    padding: 0;
  }
  :host ::content secondary-items > nav-item a {
    padding: 10px 0;
  }
  :host ::content secondary-items > nav-item a span {
    padding: 0;
  }
  :host ::content .nav {
    float: none !important;
  }
  :host ::content .navbar-left:hover ::content nav-item a,
  :host ::content .navbar-left:hover ::content ~ c-navbar nav-item a,
  :host ::content .navbar-left:hover ::content ~ sub-navigation nav-item a {
    color: #041e42;
  }
  :host ::content .nav-collapse-container {
    height: 100%;
    background-color: #f5f5f5;
    overflow-y: auto;
    -ms-overflow-style: auto;
  }
  :host-context(.navigation-open) > .navbar-default {
    display: block;
    height: 100vh;
  }
}

    </style><nav class="navbar navbar-default">
  <div class="collapse navbar-collapse" id="main-navigation">
    <content select="primary-items"></content>

    <template is="dom-if" if="{{moreItemsAvailable}}">
      <nav-item class="dropdown more">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          More
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <template is="dom-repeat" items="{{moreItems}}">
            <li>
              <a href="{{item.href}}">{{item.text}}</a>
            </li>
          </template>
        </ul>
      </nav-item>
    </template>

    <content select="secondary-items"></content>
  </div>
</nav>

  </template>
  <script>var name = 'c-main-navigation'; Polymer({
    is: name,
    properties: {
        siteName: String,
        siteUrl: String,
        showSearch: false,
        dealerLocator: false,
        variation: 0,
        moreItemsAvailable: {
            type: Boolean,
            value: false,
            observer: 'initMoreItem'
        },
        moreItems: {
            type: Array
        },
        fullbleed: {
            type: Boolean,
            value: true
        }
    },
    listeners: {
        'navItem-active': 'setItemActive',
        'subNavigation-attached': 'setHeaderSize',
        'fullscreen-toggled': 'setHeaderSize',
        'moreItem-toggled': 'setMoreItems',
        'navigation-close': 'navigationClose'
    },
    done: function () {
        [].slice.call(this.querySelectorAll('primary-items, secondary-items')).map(function (elm) {
            elm.classList.add('nav', 'navbar-nav');
        });
        if (this.querySelector('secondary-items')) {
            this.querySelector('secondary-items').classList.add('navbar-right');
        }
        // Show hamburger menu if item exist in main-navigation
        if (this.querySelectorAll('nav-item').length) {
            this.header.hasMainNav = true;
        }
        // The timeout here is used to delay the callback until template is fully rendered
        setTimeout((function () {
            this.sticky.call(this);
            this.setHeaderSize.call(this);
            this.setMoreItems.call(this);
        }).bind(this));
    },
    created: function () {
        this.header = document.querySelector('c-corporate-header');
        var self = this, url = this.resolveUrl('https://static.scania.com/vendors/frameworks/bootstrap.native/2.0.21/dist/bootstrap-native.js');
        if (window.define) {
            requirejs([url], function (bsn) {
                Object.assign(window, bsn);
                self.done.call(self);
            });
        }
        else {
            window.CorporateUi.importScript(url, this.done.bind(this));
        }
    },
    attached: function () {
        this.style.display = 'block';
        this.siteName = this.header.siteName;
        this.siteUrl = this.header.siteUrl;
        // If corporate-header exists tell the logotype to have sticky handling
        if (this.header) {
            this.header.querySelector('.navbar-symbol').classList.add('should-stick');
        }
        var nav = this.querySelector('#main-navigation'), styleElm = document.createElement('style');
        this.insertBefore(styleElm, this.children[0]);
        window.addEventListener('scroll', this.sticky.bind(this));
        window.addEventListener('resize', (function () {
            this.setHeaderSize.call(this);
            this.setMoreItems.call(this);
        }).bind(this));
        nav.addEventListener('show.bs.collapse', function () {
            document.body.classList.add('navigation-open');
        });
        nav.addEventListener('hidden.bs.collapse', (function () {
            document.body.classList.remove('navigation-open');
            this.setHeaderSize.call(this);
        }).bind(this));
        // Set start collapse value - couldnt get this to work in a better way...
        // this.querySelector('.navbar-toggle').classList.add('collapsed');
    },
    setItemActive: function (event) {
        var parent = event.target.parentNode;
        if (parent.preActive && parent.preActive !== event.target) {
            parent.preActive.active = false;
        }
        parent.preActive = event.target;
        // $('.navbar-toggle').trigger('click');
        this.setHeaderSize.call(this);
    },
    setHeaderSize: function () {
        var headerHeight = 'auto', elm = this.querySelector('.navbar-toggle'), elm2 = this.querySelector('.navbar-default'), elm3 = this.querySelector('nav-item.active sub-navigation');
        // This is set to make height calculation correct.
        // The height of the child is otherwise inherited by the parent
        this.children[0].style.height = 'auto';
        if (elm2 && elm2.offsetHeight) {
            headerHeight = elm2.offsetHeight;
            if (elm3 && elm3.offsetHeight) {
                headerHeight += elm3.offsetHeight;
            }
        }
        if (elm && elm.getClientRects().length) {
            headerHeight = elm.offsetHeight;
        }
        if (parseInt(this.style.height) != headerHeight) {
            this.style.cssText = 'display: block; height: ' + headerHeight + (isNaN(Number(headerHeight)) ? ';' : 'px;');
        }
        this.querySelector('.navbar-default').removeAttribute('style');
    },
    setMoreItems: function () {
        var primary = this.querySelector('primary-items'), secondary = this.querySelector('secondary-items'), styleElm = this.querySelector('style'), itemsWidth;
        if (window.moreItemDelay) {
            clearTimeout(window.moreItemDelay);
        }
        // We have a delay here to make sure the navigation 
        // doesnt flicker on resize
        window.moreItemDelay = setTimeout((function () {
            styleElm.innerText = '';
            itemsWidth = primary.offsetWidth + (secondary ? secondary.offsetWidth : 0);
            if (itemsWidth >= this.offsetWidth) {
                this.moreItemsAvailable = true;
            }
        }).bind(this), 100);
    },
    initMoreItem: function (val) {
        if (!val) {
            return;
        }
        this.moreItems = [];
        // Async is used to make sure template has rerendered before
        // continuing. Else dropdown nav-item is not rendered
        this.async(function () {
            var primary = this.querySelector('primary-items'), secondary = this.querySelector('secondary-items'), styleElm = this.querySelector('style'), dropdown = this.querySelector('.dropdown-toggle'), availableSpace = this.offsetWidth - (secondary ? secondary.offsetWidth + 2 : 0);
            primary.style.width = (availableSpace - dropdown.offsetWidth) + 'px';
            new Dropdown(dropdown);
            [].slice.call(primary.querySelectorAll('nav-item')).map((function (item, index) {
                if (item.offsetTop && !styleElm.innerText) {
                    styleElm.innerText = '\
            c-main-navigation nav-item:nth-child(1n+' + index + ') { display: none; } \
            c-main-navigation .more li:nth-child(1n+' + (index + 1) + ') { display: block; }';
                }
                var node = item.querySelector('a');
                this.push('moreItems', {
                    text: node.text,
                    href: node.getAttribute('href')
                });
            }).bind(this));
            primary.removeAttribute('style');
            this.moreItemsAvailable = false;
            this.setHeaderSize.call(this);
        });
    },
    navigationClose: function () {
        new window.Collapse(this.header.querySelector('.navbar-toggle'));
    },
    sticky: function () {
        var stickyNavTop = this.offsetTop, scrollTop = typeof window.scrollY === 'undefined' ? window.pageYOffset : window.scrollY; // our current vertical position from the top
        if (scrollTop <= Math.max(stickyNavTop, 0)) {
            document.body.classList.remove('header-is-sticky');
        }
        else {
            document.body.classList.add('header-is-sticky');
        }
    }
});

  </script>
</dom-module>